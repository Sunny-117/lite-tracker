# Node 的事件环

```bash
   ┌───────────────────────────┐
┌─>│           timers          │（setTimeout() 和 setInterval()）
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │     pending callbacks     │（执行延迟到下一个循环迭代的 I/O 回调）
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │       idle, prepare       │（内部控制）
│  └─────────────┬─────────────┘      ┌───────────────┐
│  ┌─────────────┴─────────────┐      │   incoming:   │
│  │           poll            │<─────┤  connections, │ （检索新的I/O事件;执行与 I/O相关的回调）
│  └─────────────┬─────────────┘      │   data, etc.  │
│  ┌─────────────┴─────────────┐      └───────────────┘
│  │           check           │（setImmediate() 回调函数在这里执行）
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
└──┤      close callbacks      │（一些关闭的回调函数）
   └───────────────────────────┘

```

以上都是宏任务

> -> timers setInterval 定时器
>
> -> poll 阶段 轮询 会在特定的时候进行阻塞 执行 i/o 回调
>
> -> check setImmediate (每个宏任务执行完毕后都会清空微任务)

每次从宏任务队列中拿出一个宏任务执行，完成后清空微任务队列（`process.nextTick()`，`promise`）
